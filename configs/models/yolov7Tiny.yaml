# YOLOv7-Tiny 輕量版模型架構設定檔 (Lightweight Model Configuration)
#
# YOLOv7-Tiny 是 YOLOv7 的輕量版本，適合在以下情況使用:
# - 邊緣裝置 (如樹莓派、Jetson Nano)
# - 即時應用 (需要極高 FPS)
# - 記憶體受限的環境
# - 快速原型開發和測試
#
# 與標準版相比:
# - 參數量減少約 85%
# - 推論速度提升約 3 倍
# - 準確度略有下降 (mAP 約 -10%)
#
# 參考資料: https://github.com/WongKinYiu/yolov7

# ==================================================
# 基本參數 (Basic Parameters)
# ==================================================

# 類別數量
nc: 80

# 深度倍數 (較小使網路更淺)
depthMultiple: 1.0

# 寬度倍數 (較小使通道數更少)
widthMultiple: 1.0

# ==================================================
# 錨點框設定 (Anchor Boxes)
# ==================================================
#
# Tiny 版本使用與標準版相同的錨點框配置，
# 因為錨點框是根據資料集統計得出的，與模型大小無關。

anchors:
  - [10, 13, 16, 30, 33, 23]        # P3/8  (小物體)
  - [30, 61, 62, 45, 59, 119]       # P4/16 (中物體)
  - [116, 90, 156, 198, 373, 326]   # P5/32 (大物體)

# ==================================================
# 骨幹網路架構 (Backbone)
# ==================================================
#
# Tiny 版本使用簡化的骨幹網路:
# - 減少 E-ELAN 模組的複雜度
# - 使用更少的通道數
# - 移除部分冗餘層

backbone:
  # ============= Stem =============
  - [-1, 1, Conv, [32, 3, 2]]       # 0: 下採樣到 H/2

  # ============= Stage 1 (P1/2) =============
  - [-1, 1, Conv, [64, 3, 2]]       # 1: 下採樣到 H/4

  # ============= Stage 2 (P2/4) =============
  - [-1, 1, Conv, [32, 1, 1]]       # 2
  - [-2, 1, Conv, [32, 1, 1]]       # 3
  - [-1, 1, Conv, [32, 3, 1]]       # 4
  - [-1, 1, Conv, [32, 3, 1]]       # 5
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 6: 特徵聚合
  - [-1, 1, Conv, [64, 1, 1]]       # 7: 通道調整

  # ============= Stage 3 (P3/8) =============
  - [-1, 1, MPConv, [64]]           # 8: 下採樣到 H/8
  - [-1, 1, Conv, [64, 1, 1]]       # 9
  - [-2, 1, Conv, [64, 1, 1]]       # 10
  - [-1, 1, Conv, [64, 3, 1]]       # 11
  - [-1, 1, Conv, [64, 3, 1]]       # 12
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 13
  - [-1, 1, Conv, [128, 1, 1]]      # 14: P3 輸出

  # ============= Stage 4 (P4/16) =============
  - [-1, 1, MPConv, [128]]          # 15: 下採樣到 H/16
  - [-1, 1, Conv, [128, 1, 1]]      # 16
  - [-2, 1, Conv, [128, 1, 1]]      # 17
  - [-1, 1, Conv, [128, 3, 1]]      # 18
  - [-1, 1, Conv, [128, 3, 1]]      # 19
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 20
  - [-1, 1, Conv, [256, 1, 1]]      # 21: P4 輸出

  # ============= Stage 5 (P5/32) =============
  - [-1, 1, MPConv, [256]]          # 22: 下採樣到 H/32
  - [-1, 1, Conv, [256, 1, 1]]      # 23
  - [-2, 1, Conv, [256, 1, 1]]      # 24
  - [-1, 1, Conv, [256, 3, 1]]      # 25
  - [-1, 1, Conv, [256, 3, 1]]      # 26
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 27
  - [-1, 1, Conv, [512, 1, 1]]      # 28: P5 輸出

# ==================================================
# 頸部網路架構 (Neck)
# ==================================================
#
# Tiny 版本使用簡化的 FPN-PAN 結構

neck:
  # ============= SPP (Spatial Pyramid Pooling) =============
  # 簡化版的空間金字塔池化
  - [-1, 1, SPP, [256, [5, 9, 13]]] # 29: SPP 模組

  # ============= FPN 自頂向下 =============
  - [-1, 1, Conv, [128, 1, 1]]      # 30
  - [-1, 1, Upsample, [2]]          # 31
  - [21, 1, Conv, [128, 1, 1]]      # 32: 處理 P4
  - [[-1, -2], 1, Concat, [1]]      # 33
  - [-1, 1, Conv, [64, 1, 1]]       # 34
  - [-2, 1, Conv, [64, 1, 1]]       # 35
  - [-1, 1, Conv, [64, 3, 1]]       # 36
  - [-1, 1, Conv, [64, 3, 1]]       # 37
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 38
  - [-1, 1, Conv, [128, 1, 1]]      # 39: FPN P4 輸出

  - [-1, 1, Conv, [64, 1, 1]]       # 40
  - [-1, 1, Upsample, [2]]          # 41
  - [14, 1, Conv, [64, 1, 1]]       # 42: 處理 P3
  - [[-1, -2], 1, Concat, [1]]      # 43
  - [-1, 1, Conv, [32, 1, 1]]       # 44
  - [-2, 1, Conv, [32, 1, 1]]       # 45
  - [-1, 1, Conv, [32, 3, 1]]       # 46
  - [-1, 1, Conv, [32, 3, 1]]       # 47
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 48
  - [-1, 1, Conv, [64, 1, 1]]       # 49: FPN P3 輸出

  # ============= PAN 自底向上 =============
  - [-1, 1, Conv, [64, 3, 2]]       # 50: 下採樣
  - [[-1, 39], 1, Concat, [1]]      # 51
  - [-1, 1, Conv, [64, 1, 1]]       # 52
  - [-2, 1, Conv, [64, 1, 1]]       # 53
  - [-1, 1, Conv, [64, 3, 1]]       # 54
  - [-1, 1, Conv, [64, 3, 1]]       # 55
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 56
  - [-1, 1, Conv, [128, 1, 1]]      # 57: PAN P4 輸出

  - [-1, 1, Conv, [128, 3, 2]]      # 58: 下採樣
  - [[-1, 29], 1, Concat, [1]]      # 59
  - [-1, 1, Conv, [128, 1, 1]]      # 60
  - [-2, 1, Conv, [128, 1, 1]]      # 61
  - [-1, 1, Conv, [128, 3, 1]]      # 62
  - [-1, 1, Conv, [128, 3, 1]]      # 63
  - [[-1, -2, -3, -4], 1, Concat, [1]]  # 64
  - [-1, 1, Conv, [256, 1, 1]]      # 65: PAN P5 輸出

# ==================================================
# 檢測頭架構 (Detection Head)
# ==================================================

head:
  # 檢測層
  - [[49, 57, 65], 1, Detect, [nc, anchors]]  # 66: 最終輸出

# ==================================================
# 模型參數統計 (Model Statistics)
# ==================================================
#
# YOLOv7-Tiny (640x640 輸入):
# - 參數量: ~6.2M
# - FLOPs: ~13.8G
# - 推論速度: ~480 FPS (V100 GPU)
# - COCO mAP: 38.7%
#
# 適用場景:
# - 即時視訊串流分析
# - 行動裝置應用
# - IoT 邊緣運算
# - 初學者學習和實驗
